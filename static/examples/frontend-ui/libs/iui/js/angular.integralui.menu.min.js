/*
  filename: angular.integralui.menu.min.js
  version : 1.1.5
  Copyright © 2014-2017 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUIMenuService",["$rootScope","IntegralUIPublicService",function(b,w){return{addItem:function(e,g,m){b.$broadcast(e+"-add-item",g,m)},clearItems:function(e,g){b.$broadcast(e+"-clear-items",g)},insertItemAt:function(e,g,m,k){b.$broadcast(e+"-insert-item-at",g,m,k)},insertItemBefore:function(e,g,m){b.$broadcast(e+"-insert-item-before",g,m)},insertItemAfter:function(e,g,m){b.$broadcast(e+"-insert-item-after",g,m)},removeItem:function(e,g){b.$broadcast(e+"-remove-item",
g)},removeItemAt:function(e,g,m){b.$broadcast(e+"-remove-item-at",g,m)},exportToJSON:function(e,g,m,k){b.$broadcast(e+"-export-json",g,m,k);e=this.getTempData();this.clearTempData();return e?e:""},loadData:function(e,g,m,k,d){b.$broadcast(e+"-load-data",g,m,k,d)},findItemById:function(e,g){b.$broadcast(e+"-find-item-by-id",g);var m=this.getTempData();this.clearTempData();return m?m:null},findItemByText:function(e,g){b.$broadcast(e+"-find-item-by-text",g);var m=this.getTempData();this.clearTempData();
return m?m:null},getList:function(e,g,m){b.$broadcast(e+"-get-list",g,m);e=this.getTempData();this.clearTempData();return e?e:[]},beginLoad:function(e,g){b.$broadcast(e+"-begin-load",g)},closeMenu:function(e,g){b.$broadcast(e+"-close-menu",g)},endLoad:function(e){b.$broadcast(e+"-end-load")},openMenu:function(e,g){b.$broadcast(e+"-open-menu",g)},refresh:function(e){b.$broadcast(e+"-refresh")},resumeLayout:function(e){b.$broadcast(e+"-resume-layout")},suspendLayout:function(e){b.$broadcast(e+"-suspend-layout")},
updateLayout:function(e,g){b.$broadcast(e+"-update-layout",g)}}}]).controller("IntegralUIMenuController",["$scope","$element","IntegralUIInternalService","IntegralUIDataService","IntegralUIMenuService","$timeout",function(b,w,e,g,m,k){var d=this;d.hoverItem=null;d.defaultStyle={general:{disabled:"iui-menu-disabled",normal:"iui-menu"},block:{general:"iui-menu-block",marker:{top:"iui-menu-marker-top",left:"iui-menu-marker-left",bottom:"iui-menu-marker-bottom",right:"iui-menu-marker-right",rtlTop:"iui-menu-marker-top-rtl",
expand:{down:"iui-menu-marker-expand-down",right:"iui-menu-marker-expand-right",rtlDown:"iui-menu-marker-expand-down-rtl",up:"iui-menu-marker-expand-up",left:"iui-menu-marker-expand-left",rtlSpace:"iui-menu-marker-expand-space-rtl",space:"iui-menu-marker-expand-space"}}},item:{general:{disabled:"iui-menu-item-disabled",focused:"iui-menu-item-focused",normal:"iui-menu-item",hovered:"iui-menu-item-hovered",selected:"iui-menu-item-selected"},content:"iui-menu-item-content",loadIcon:{general:"iui-menu-load",
icon:"iui-submenu-load-icon"},separator:"iui-menu-item-separator"},root:{general:{disabled:"iui-menu-item-root-disabled",focused:"iui-menu-item-root-focused",normal:"iui-menu-item-root",hovered:"iui-menu-item-root-hovered",selected:"iui-menu-item-root-selected",vertical:"iui-menu-item-root-vertical"},content:"iui-menu-item-root-content",loadIcon:{general:"iui-menu-load",icon:"iui-menu-load-icon"},separator:"iui-menu-root-separator"}};this.updateOptions=function(c){c?(d.options={controlStyle:e.isFieldAvailable(c.controlStyle,
d.defaultStyle),displayMode:e.isFieldAvailable(c.displayMode,"horizontal"),enabled:e.isFieldAvailable(c.enabled,!0),itemIcon:e.isFieldAvailable(c.itemIcon,""),openOnHover:e.isFieldAvailable(c.openOnHover,!1),rtl:e.isFieldAvailable(c.rtl,!1),showDropDownIcon:e.isFieldAvailable(c.showIcons,!1),showIcons:e.isFieldAvailable(c.showIcons,!0)},d.updateDataFields(c.dataFields),d.updateControlStyle(c.controlStyle)):(d.options={controlStyle:d.defaultStyle,displayMode:"horizontal",enabled:!0,itemIcon:"",openOnHover:!1,
rtl:!1,showDropDownIcon:!1,showIcons:!0},d.updateDataFields())};d.options={};this.updateDataFields=function(c){d.options.dataFields=c?{enabled:c.enabled?c.enabled:"enabled",hasChildren:c.hasChildren?c.hasChildren:"hasChildren",icon:c.icon?c.icon:"icon",id:c.id?c.id:"id",items:c.items?c.items:"items",pid:c.pid?c.pid:"pid",selected:c.selected?c.selected:"selected",style:c.style?c.style:"style",text:c.text?c.text:"text",type:c.type?c.type:"type",value:c.value?c.value:"value"}:{enabled:"enabled",hasChildren:"hasChildren",
icon:"icon",id:"id",items:"items",pid:"pid",selected:"selected",style:"style",text:"text",type:"type",value:"value"};d.dataObj&&d.dataObj.updateDataFields(d.options.dataFields)};d.updateOptions();b.$on(b.name+"-add-item",function(c,a,b){d.dataObj.insertAt(a,-1,b,d.itemIsAdded)});b.$on(b.name+"-clear-items",function(c,a){d.dataObj.clear(a,d.listIsCleared)});b.$on(b.name+"-insert-item-at",function(c,a,b,e){d.dataObj.insertAt(a,b,e,d.itemIsAdded)});b.$on(b.name+"-insert-item-after",function(c,a,b){d.dataObj.insertByRef(a,
b,!0,d.itemIsAdded)});b.$on(b.name+"-insert-item-before",function(c,a,b){d.dataObj.insertByRef(a,b,!1,d.itemIsAdded)});b.$on(b.name+"-remove-item",function(c,a){d.dataObj.removeAt(a,-1,null,d.itemIsRemoved)});b.$on(b.name+"-remove-item-at",function(c,a,b){d.dataObj.removeAt(null,a,b,d.itemIsRemoved)});this.listIsCleared=function(c){d.updateLayout()};this.itemIsAdded=function(){d.updateLayout()};this.itemIsRemoved=function(){d.updateLayout()};d.currentList=[];d.isThereChildItems=!1;var B=function(c,
a,b){c.type||(c.type="item",d.isRoot(c)&&(c.type="root"));c[d.options.dataFields.id]||(c[d.options.dataFields.id]=e.getUniqueId());a&&(c[d.options.dataFields.pid]=a);b?d.fullList.push(c):d.currentList.push(c)},a=function(c,b,e){if(c[d.options.dataFields.items]){if(B(c,b,e),b=c[d.options.dataFields.items])for(var q=0;q<b.length;q++)a(b[q],c[d.options.dataFields.id],e)}else B(c,b,e)};d.fullList=[];this.getFullList=function(c){return d.fullList};this.updateFullList=function(){d.fullList.length=0;var c=
d.dataObj.getList();if(c)for(var b=0;b<c.length;b++)a(c[b],null,!0);return d.fullList};this.getCurrentList=function(){return d.currentList};this.updateCurrentList=function(){d.currentList.length=0;var c=d.dataObj.getList();if(c)for(var a=0;a<c.length;a++)B(c[a],0,null,!1)};this.getItemFullIndex=function(c){return c&&d.fullList?d.fullList.indexOf(c):-1};this.getDataFields=function(c){return{icon:c.icon?c.icon:"icon",id:c.id?c.id:"id",pid:c.pid?c.pid:"pid",objects:c.items?c.items:"items",text:c.text?
c.text:"text"}};d.dataObj=new g({objects:b.items,events:{clear:function(c){return angular.isDefined(b.events)&&b.events.clear?b.events.clear({parent:c.e.parent}):b.clear(c)},objAdded:function(c){return angular.isDefined(b.events)&&b.events.itemAdded?b.events.itemAdded({item:c.e.item}):b.itemAdded(c)},objAdding:function(c){return angular.isDefined(b.events)&&b.events.itemAdding?b.events.itemAdding({item:c.e.item}):b.itemAdding(c)},objRemoved:function(c){return angular.isDefined(b.events)&&b.events.itemRemoved?
b.events.itemRemoved({item:c.e.item}):b.itemRemoved(c)},objRemoving:function(c){return angular.isDefined(b.events)&&b.events.itemRemoving?b.events.itemRemoving({item:c.e.item}):b.itemRemoving(c)}},fields:d.getDataFields(d.options.dataFields)});b.$on(b.name+"-load-data",function(c,a,b,e,g){d.loadData(a,b,e,g)});b.$on(b.name+"-export-json",function(c,a,b,e){m.setTempData(d.exportToJSON(a,b,e))});this.exportToJSON=function(c,a,b){b=b?b:null;var e=0!=a?d.getFullList():d.dataObj.getList();c=c?c:[d.options.dataFields.enabled,
d.options.dataFields.icon,d.options.dataFields.id,d.options.dataFields.hasChildren,d.options.dataFields.pid,d.options.dataFields.style,d.options.dataFields.text,d.options.dataFields.type,d.options.dataFields.value];0==a&&c.push(d.options.dataFields.items);return JSON.stringify(e,c,b)};this.loadData=function(c,a,e,q){d.allowEvents=!1;d.updateDataFields(e);var m=[],k=d.options.dataFields;d.dataObj.clear(a);if(c)if(0!=q){var u=[];c.forEach(function(c,a){var d=c[k.pid];u[d]?(u[d][k.items]||(u[d][k.items]=
[]),u[c[k.id]]=c,u[d][k.items].push(c)):(u[c[k.id]]=c,m.push(c))});u.length=0}else m=c;if(a)for(a[d.options.dataFields.items]=m,c=0;c<a[d.options.dataFields.items].length;c++)a[d.options.dataFields.items][c][d.options.dataFields.pid]=a[d.options.dataFields.id];else angular.isDefined(b.items)&&(b.items=m);d.dataObj=new g({objects:b.items,events:d.dataEvents,fields:d.getDataFields(d.options.dataFields)});d.updateLayout(a);d.allowEvents=!0};this.callClose=function(c){return angular.isDefined(b.events)&&
b.events.close?b.events.close({item:c}):b.close({e:{item:c}})};this.callItemClick=function(c,a){return angular.isDefined(b.events)&&b.events.itemClick?b.events.itemClick({item:c,mousePos:a}):b.itemClick({e:{item:c,mousePos:a}})};this.callItemHover=function(c){angular.isDefined(b.events)&&b.events.itemHover?b.events.itemHover({item:c}):b.itemHover({e:{item:c}})};this.callEnabledChanged=function(c){angular.isDefined(b.events)&&b.events.enabledChanged?b.events.enabledChanged({enabled:c}):b.enabledChanged({e:{enabled:c}})};
this.callOpen=function(c){return angular.isDefined(b.events)&&b.events.open?b.events.open({item:c}):b.open({e:{item:c}})};this.callStyleChanged=function(c){angular.isDefined(b.events)&&b.events.styledChanged?b.events.styleChanged({style:c}):b.styleChanged({e:{style:c}})};b.$on(b.name+"-get-list",function(c,a,b){1==b?m.setTempData(d.getFullList(a)):m.setTempData(d.getList(a))});this.getElemFromItem=function(c){var a=null;if(c){c=d.getItemFullIndex(c);var b=w.find("li");if(b&&0<b.length)for(var e=0;e<
b.length;e++){var g=angular.element(b[e]);if(g[0].attributes["data-index"]&&g[0].attributes["data-index"].value.toString()===c.toString()){a=g;break}}}return a};this.getBlockElemFromItem=function(c){var a=null;c&&(c=d.getElemFromItem(c))&&(c=c.find("ul"),0<c.length&&(a=angular.element(c.eq(0))));return a};this.getItemFromChildElem=function(c){return c?(c=angular.element(c))?d.getItemFromElem(c[0].parentElement):null:null};this.getItemFromElem=function(c){if(c&&(c=angular.element(c))&&c[0].attributes["data-index"]&&
(c=c[0].attributes["data-index"].value,d.isIndexInRange(c)))return d.fullList[c]};this.getObjState=function(c){if(c&&"separator"!=c.type){if(0==d.options.enabled||0==c[d.options.dataFields.enabled])return"disabled";if(c==d.hoverItem)return"hovered";if(1==c[d.options.dataFields.selected])return"selected"}return"normal"};this.getItemIndex=function(c){var a=d.getParent(c),a=d.getList(a);return d.dataObj.getIndexOf(c,a)};this.getParent=function(c){return d.dataObj.getParent(c)};this.getList=function(c){return d.dataObj.getList(c)};
this.isIndexInRange=function(c){return 0<=c&&c<d.fullList.length};this.isItemEnabled=function(c){return c?e.isEnabled(c[d.options.dataFields.enabled]):!1};this.isRoot=function(c){return!c||void 0!=c[d.options.dataFields.pid]&&null!=c[d.options.dataFields.pid]?!1:!0};d.allowUpdate=!0;this.suspendLayout=function(){d.allowUpdate=!1};this.resumeLayout=function(){d.allowUpdate=!0;d.updateLayout()};b.$on(b.name+"-refresh",function(c){d.refresh(null,!0)});b.$on(b.name+"-resume-layout",function(c){d.resumeLayout()});
b.$on(b.name+"-suspend-layout",function(c){d.suspendLayout()});b.$on(b.name+"-update-layout",function(c,a){d.updateLayout(a)});b.$on(b.name+"-begin-load",function(c,a){var b=k(function(){d.options.loadItem=a;d.refresh(null,!0);k.cancel(b)},1)});b.$on(b.name+"-close-menu",function(c,a){d.closeItem(a);d.refresh(null,!0)});b.$on(b.name+"-end-load",function(c){var a=k(function(){d.options.loadItem=null;d.refresh(null,!0);k.cancel(a)},1)});b.$on(b.name+"-open-menu",function(c,a){d.openItem(a)});b.$watch("controlStyle",
function(c,a){c!==a&&(d.options.controlStyle=c,d.refresh(null,!0),d.callStyleChanged(c))});b.$watch("enabled",function(c,a){c!==a&&(d.options.enabled=c,d.updateLayout(),d.callEnabledChanged(c))});b.$watch("openOnHover",function(a,b){a!==b&&(d.options.openOnHover=a,d.updateLayout())});b.$watch("displayMode",function(a,b){a!==b&&(d.options.displayMode=a,d.updateLayout())});b.$watch("options",function(a,b){a!==b&&d.updateOptions(a)},!0);b.$watch("rtl",function(a,b){a!==b&&(d.options.rtl=a,d.updateLayout())});
b.$watch("showIcons",function(a,b){a!==b&&(d.options.showIcons=a,d.updateLayout())});var E=function(a){if(a){var b=e.isFieldAvailable(a.general,"iui-menu-block");var f=a.marker;if(f){a=e.isFieldAvailable(f.top,"iui-menu-marker-top");var g=e.isFieldAvailable(f.left,"iui-menu-marker-left"),k=e.isFieldAvailable(f.bottom,"iui-menu-marker-bottom"),m=e.isFieldAvailable(f.right,"iui-menu-marker-right"),f=(f=f.expand)?{down:e.isFieldAvailable(f.down,"iui-menu-marker-expand-down"),right:e.isFieldAvailable(f.right,
"iui-menu-marker-expand-right"),up:e.isFieldAvailable(f.up,"iui-menu-marker-expand-up"),left:e.isFieldAvailable(f.left,"iui-menu-marker-expand-left"),space:e.isFieldAvailable(f.space,"iui-menu-marker-expand-space")}:d.options.controlStyle.block.marker.expand;a={top:a,left:g,bottom:k,right:m,expand:f}}else a=d.options.controlStyle.block.marker;return{general:b,marker:a}}return d.options.controlStyle.block},r=function(a){if(a){var b;b=(b=a.general)?{disabled:e.isFieldAvailable(b.disabled,"iui-menu-item-disabled"),
focused:e.isFieldAvailable(b.focused,"iui-menu-item-focused"),normal:e.isFieldAvailable(b.normal,"iui-menu-item"),hovered:e.isFieldAvailable(b.hovered,"iui-menu-item-hovered"),selected:e.isFieldAvailable(b.selected,"iui-menu-item-selected")}:d.options.controlStyle.item.general;var f=e.isFieldAvailable(a.content,"iui-menu-item-content"),g;g=(g=a.loadIcon)?{general:e.isFieldAvailable(g.general,"iui-menu-load"),icon:e.isFieldAvailable(g.icon,"iui-submenu-load-icon")}:d.options.controlStyle.item.loadIcon;
return{general:b,content:f,loadIcon:g,separator:e.isFieldAvailable(a.separator,"iui-menu-item-separator")}}return d.options.controlStyle.item},x=function(a){if(a){var b;b=(b=a.general)?{disabled:e.isFieldAvailable(b.disabled,"iui-menu-item-root-disabled"),focused:e.isFieldAvailable(b.focused,"iui-menu-item-root-focused"),normal:e.isFieldAvailable(b.normal,"iui-menu-item-root"),hovered:e.isFieldAvailable(b.hovered,"iui-menu-item-root-hovered"),selected:e.isFieldAvailable(b.selected,"iui-menu-item-root-selected"),
vertical:e.isFieldAvailable(b.vertical,"iui-menu-item-root-vertical")}:d.options.controlStyle.root.general;var f=e.isFieldAvailable(a.content,"iui-menu-item-root-content"),g;g=(g=a.loadIcon)?{general:e.isFieldAvailable(g.general,"iui-menu-load"),icon:e.isFieldAvailable(g.icon,"iui-menu-load-icon")}:d.options.controlStyle.root.loadIcon;return{general:b,content:f,loadIcon:g,separator:e.isFieldAvailable(a.separator,"iui-menu-root-separator")}}return d.options.controlStyle.root};this.getCurrentItemStyle=
function(a,b){var f=d.options.controlStyle.item;if(a)switch(a.style){case "initial":break;case "parent":return d.getCurrentItemStyle(d.getParent(a),b);default:null!=a.style&&(f=a.style)}if(b){if(e.isString(f.general))return f.general;switch(b){case "disabled":return f.general&&f.general.disabled?f.general.disabled:d.options.controlStyle.item.general.disabled;case "focused":return f.general&&f.general.focused?f.general.focused:d.options.controlStyle.item.general.focused;case "hovered":return f.general&&
f.general.hovered?f.general.hovered:d.options.controlStyle.item.general.hovered;case "selected":return f.general&&f.general.selected?f.general.selected:d.options.controlStyle.item.general.selected;default:return f.general&&f.general.normal?f.general.normal:d.options.controlStyle.item.general.normal}}else return f?f:d.options.controlStyle.item};this.getCurrentRootStyle=function(a,b){var f=d.options.controlStyle.root;if(a)switch(a.style){case "initial":break;default:null!=a.style&&(f=a.style)}if(b){if(e.isString(f.general))return f.general;
switch(b){case "disabled":return f.general&&f.general.disabled?f.general.disabled:d.options.controlStyle.root.general.disabled;case "focused":return f.general&&f.general.focused?f.general.focused:d.options.controlStyle.root.general.focused;case "hovered":return f.general&&f.general.hovered?f.general.hovered:d.options.controlStyle.root.general.hovered;case "selected":return f.general&&f.general.selected?f.general.selected:d.options.controlStyle.root.general.selected;default:return f.general&&f.general.normal?
f.general.normal:d.options.controlStyle.root.general.normal}}else return f?f:d.options.controlStyle.root};var z=function(a){return a?e.isString(a)?a:{disabled:e.isFieldAvailable(a.disabled,"iui-menu-disabled"),normal:e.isFieldAvailable(a.normal,"iui-menu")}:d.defaultStyle.general};this.updateControlStyle=function(a){d.options.controlStyle=a?{general:z(a.general),block:E(a.block),item:r(a.item),root:x(a.root)}:{general:z(d.defaultStyle.general),block:E(d.defaultStyle.block),item:r(d.defaultStyle.item),
root:x(d.defaultStyle.root)}}}]).directive("iuiMenu",["$compile","$window","$timeout","$interval","IntegralUIInternalService",function(b,w,e,g,m){return{restrict:"EA",controller:"IntegralUIMenuController",transclude:!0,replace:!0,template:'<div class="iui-menu" data-element="menu"><ul class="iui-menu-block"></ul></div>',scope:{controlStyle:"=",enabled:"=",itemIcon:"=",items:"=",name:"@",openOnHover:"=",options:"=?",displayMode:"@",rtl:"=",showDropdownIcon:"=",showIcons:"=",close:"&",enabledChanged:"&",
events:"=?",itemAdded:"&",itemAdding:"&",itemClick:"&",itemHover:"&",itemRemoved:"&",itemRemoving:"&",open:"&",styleChanged:"&"},link:function(k,d,B,a,E){var r=d.children().eq(0),x=function(a){d.unbind("mouseleave");a=a?a.find("li"):r.children();if(0<a.length)for(var c=0;c<a.length;c++)currentElem=angular.element(a[c]),currentElem.unbind("click mouseenter mouseleave touchstart")},z=function(b){if(1==a.options.enabled){var e=null;d.bind("mouseleave",function(a){a.stopPropagation()});b=b?b.find("li"):
r.children();if(0<b.length)for(var F=null,f=0;f<b.length;f++)F=angular.element(b[f]),(e=a.getItemFromElem(F))&&a.isItemEnabled(e)&&c(F)}},c=function(c){c&&(c.bind("click",function(c){var b=a.getItemFromElem(this);b&&0!=a.callItemClick(b,m.getMousePos(c))&&(a.isRoot(b)?(angular.element(this),q?(a.closeItem(b),a.isRoot(b)&&(q=!1,p=null)):a.openItem(b)):A(b)||D());c.stopPropagation()}),c.bind("mouseenter",function(c){var b=a.getItemFromElem(this);b&&(angular.element(this),a.hoverItem=b,a.refresh(null,
!0),a.callItemHover(b),a.options.openOnHover||!a.isRoot(b)?(t&&e.cancel(t),t=e(function(){t&&a.openItem(b)},500)):q&&b!=p&&(p&&a.closeItem(p),a.openItem(b)));c.stopPropagation()}),c.bind("mouseleave",function(c){a.hoverItem=null;var b=a.getItemFromElem(this);if(b&&(a.refresh(null,!0),!a.options.openOnHover&&p&&(p[a.options.dataFields.selected]=!0,a.refresh(p)),a.options.openOnHover||!a.isRoot(b)))var d=e(function(){a.closeItem(b);e.cancel(d)},250);t&&e.cancel(t);t=null}),c.bind("touchstart",function(c){c.preventDefault();
var b=m.getTouchData(c);b&&0<b.length&&((b=a.getItemFromElem(this))&&0!=a.callItemClick(b,m.getMousePos(c))&&(a.isRoot(b)?(angular.element(this),q?(a.closeItem(b),a.isRoot(b)&&(q=!1,p=null)):a.openItem(b)):A(b)||D()),c.stopPropagation())}))},I=function(a){D()},f=function(b){switch(b.keyCode){case 27:a.closeItem(p),q=!1,p=null,a.refresh(null,!0)}};angular.element(w).bind("click",I);angular.element(w).bind("keydown",f);var q=!1,p=null,v=[],u=function(b){return b?(b=b[a.options.dataFields.items],void 0!=
b&&0<b.length):!1};a.openItem=function(b){var c=a.getElemFromItem(b);if(b&&A(b)&&n&&c){var d=c.find("ul");if(0<d.length&&0!=a.callOpen(b)){d=angular.element(d.eq(0));x(d);u(b)&&(c.removeClass(a.options.controlStyle.block.marker.expand.down),c.removeClass(a.options.controlStyle.block.marker.expand.left),c.removeClass(a.options.controlStyle.block.marker.expand.right),c.removeClass(a.options.controlStyle.block.marker.expand.rtlDown));q=!0;(p=a.isRoot(b)?b:p)&&(p[a.options.dataFields.selected]=!0);0>
v.indexOf(p)&&v.unshift(p);for(var f=0;f<v.length;f++)v[f]!=p&&(v[f][a.options.dataFields.selected]=!1,a.closeItem(v[f]));v.splice(1,v.length-1);if(u(b)){f=a.getItemIndex(b);if(0<=f){var g=0,l="auto",h="auto",k=angular.element(c.parent()),t=m.getPadding(c[0]),r=m.getPadding(k[0]);a.options.rtl?"vertical"==a.options.displayMode?a.isRoot(b)?(g=0,h=-(k[0].offsetWidth+16)):(g-=r.top,l=k[0].offsetWidth-8):a.isRoot(b)?(g=c[0].offsetTop-t.bottom+c[0].offsetHeight,l=0):(g-=r.top,l=k[0].offsetWidth-8):"vertical"==
a.options.displayMode?(g=a.isRoot(b)?0:g-r.top,h=k[0].offsetWidth-8):a.isRoot(b)?(g=c[0].offsetTop-t.bottom+c[0].offsetHeight,h=0):(g-=r.top,h=k[0].offsetWidth-8);c="display:block;"+("top:"+g+"px;");"auto"!=h&&(c+="left:"+h+"px;");"auto"!=l&&(c+="right:"+l+"px;");(b=C(a.getParent(b)))&&b.data&&f<b.data.length&&(b.data[f].inlineBlockStyle=c,n.$apply())}e(function(){z(d);J()},1)}}}};a.closeItem=function(b){var c=a.getElemFromItem(b);if(b&&n&&c){var d=c.find("ul");0<d.length&&0!=a.callClose(b)&&(d=angular.element(d.eq(0)),
x(d),A(b)&&(a.isRoot(b)?"hovered"==a.getObjState(b)&&(a.options.rtl?c.addClass(a.options.controlStyle.block.marker.expand.rtlDown):c.addClass(a.options.controlStyle.block.marker.expand.down)):a.options.rtl?c.addClass(a.options.controlStyle.block.marker.expand.left):c.addClass(a.options.controlStyle.block.marker.expand.right)),c=a.getItemIndex(b),0<=c&&(b=C(a.getParent(b)))&&b.data&&c<b.data.length&&(b.data[c].inlineBlockStyle="display:none;",n.$apply()))}};var D=function(){a.closeItem(p);q=!1;p=null;
a.refresh(null,!0);t&&e.cancel(t);t=null},t=null,n=null,A=function(b){if(b){var c=b[a.options.dataFields.items];return b[a.options.dataFields.hasChildren]||c&&0<c.length}return!1},L=function(b,c,d){var e="";b[a.options.dataFields.icon]||""==b[a.options.dataFields.icon]?e=b[a.options.dataFields.icon]:a.options.itemIcon&&(e=a.options.itemIcon);return{icon:e,iconVisible:0!=a.options.showIcons&&(null!=b.icon||null!=a.options.itemIcon),index:c,inlineBlockStyle:"display:none",item:b,style:{},visible:d}},
G=function(b){var c=[];if(b)for(var d=0;d<b.length;d++)c.push(L(b[d],a.getItemFullIndex(b[d])));return c},J=function(){var a=r.find("li");if(0<a.length)for(var b=0;b<a.length;b++)for(var c=angular.element(a[b]),d=c.children(),e=0;e<d.length;e++){var f=angular.element(d[e]);f[0].attributes["data-element"]&&"load-icon"==f[0].attributes["data-element"].value.toString()&&f.css("top",(c[0].clientHeight-f[0].offsetHeight)/2+"px")}},M=function(){var a=r.find("li");if(0<a.length)for(var b=0;b<a.length;b++){var c=
angular.element(a[b]);c&&c.attr("data-index",b)}},K=function(a,b){var c=null;if(a&&b)for(var d=0;!c&&d<a.length;)c=a[d].item==b?a[d]:K(a[d].data,b),d++;return c},C=function(a){return a?K(n.data,a):n},N=function(c){var f=e(function(){x();a.options.rtl?d.css("direction","rtl"):d.css("direction","ltr");c||(r.empty(),n&&n.$destroy());e.cancel(f)},1),g=e(function(){var d="";if(c){var f=C(c);if(f){var l=c[a.options.dataFields.items];if(l&&0<l.length){f.data=G(l);a.refresh();n.$apply();for(var h=0;h<l.length;h++)d+=
H(h,l[h],f.scopeRef,f.data);""!=d&&(f=a.getBlockElemFromItem(c))&&(f.empty(),f.append(b(d)(n)))}M()}}else{n=k.$new();n.data=G(a.currentList);a.refresh();n.$apply();for(f=0;f<a.currentList.length;f++)d+=H(f,a.currentList[f],"data",n.data);""!=d&&r.append(b(d)(n))}z();var m=e(function(){J();e.cancel(m)},1);e.cancel(g)},1)},H=function(b,c,d,e){a.getItemFullIndex(c);var f='<li iui-class="{{'+d+"["+b+'].style.general}}" data-index="'+a.getItemFullIndex(c)+'">';switch(c.type){case "separator":f+='<hr iui-class="{{'+
d+"["+b+'].style.separator}}" data-element="separator" />';break;default:f=f+('<span iui-class="{{'+d+"["+b+'].icon}}" data-element="icon" ng-show="'+d+"["+b+'].iconVisible"></span>')+('<span iui-class="{{'+d+"["+b+'].style.content}}"  data-element="content">')+("{{"+d+"["+b+"].item."+a.options.dataFields.text+"}}"),f=f+"</span>"+('<span iui-class="{{'+d+"["+b+'].style.loadIcon}}" data-element="load-icon"></span>')}var g=c[a.options.dataFields.items];if(c[a.options.dataFields.hasChildren]||g&&0<g.length){f+=
'<ul iui-class="{{'+d+"["+b+"].style.block";switch(a.options.displayMode){case "vertical":f=a.options.rtl?f+'.marker.right}}"':f+'.marker.left}}"';break;default:f=a.options.rtl?a.isRoot(c)?f+'.marker.rtlTop}}"':f+'.marker.right}}"':a.isRoot(c)?f+'.marker.top}}"':f+'.marker.left}}"'}f+=' iui-style="{{'+d+"["+b+'].inlineBlockStyle}}">';d+="["+b+"].data";e[b].data=G(g);e[b].scopeRef=d;if(g&&0<g.length)for(c=0;c<g.length;c++)f+=H(c,g[c],e[b].scopeRef,e[b].data);f+="</ul>"}return f+"</li>"};a.updateLayout=
function(b){a.allowUpdate&&(a.updateCurrentList(),a.updateFullList(),N(b))};a.refresh=function(b,c){if(n)if(b)switch(b.type){default:var e=C(b);if(e){var f=A(b),g=a.getObjState(b),l={block:a.defaultStyle.block,content:"",general:"",label:"",loadIcon:"",separator:a.defaultStyle.item.separator},h;switch(b.type){case "root":"vertical"==a.options.displayMode?(h=a.defaultStyle.root.general.vertical,a.options.controlStyle.root.general.vertical!=h&&(h+=" "+a.options.controlStyle.root.general.vertical)):
(h=a.defaultStyle.root.general.normal,a.options.controlStyle.root.general.normal!=h&&(h+=" "+a.options.controlStyle.root.general.normal),f&&(h=a.options.rtl?h+(" "+a.defaultStyle.block.marker.expand.rtlSpace):h+(" "+a.defaultStyle.block.marker.expand.space)));l.general=h;h=a.defaultStyle.root.content;a.options.controlStyle.root.content!=h&&(h+=" "+a.options.controlStyle.root.content);l.content=h;h=a.defaultStyle.root.loadIcon.general;a.options.controlStyle.root.loadIcon.general!=h&&(h+=" "+a.options.controlStyle.root.loadIcon.general);
a.options.rtl&&(h+="-rtl");l.loadIcon=h;break;default:h=a.defaultStyle.item.general.normal,a.options.controlStyle.item.general.normal!=h&&(h+=" "+a.options.controlStyle.item.general.normal),l.general=h,h=a.defaultStyle.item.content,a.options.controlStyle.item.content!=h&&(h+=" "+a.options.controlStyle.item.content),l.content=h,h=a.defaultStyle.item.loadIcon.general,a.options.controlStyle.item.loadIcon.general!=h&&(h+=" "+a.options.controlStyle.item.loadIcon.general),a.options.rtl&&(h+="-rtl"),l.loadIcon=
h}switch(b.type){case "separator":f?(h=a.getCurrentRootStyle(b).separator,h!=a.options.controlStyle.root.separator&&(l.separator+=" "+h)):(h=a.getCurrentItemStyle(b).separator,h!=a.options.controlStyle.item.separator&&(l.separator+=" "+h));break;case "root":var k=a.getCurrentRootStyle(b);h=a.getCurrentRootStyle(b,g);"vertical"==a.options.displayMode?("normal"!=g&&h!=a.options.controlStyle.root.general.vertical&&(l.general+=" "+h),!f||(1!=a.options.showDropDownIcon||0!=b[a.options.dataFields.selected])&&
q&&u(b)||1!=a.options.showDropDownIcon&&"hovered"!=g||a.options.loadItem||(l.general=a.options.rtl?l.general+(" "+a.options.controlStyle.block.marker.expand.left):l.general+(" "+a.options.controlStyle.block.marker.expand.right))):(h!=a.options.controlStyle.root.general.normal&&(l.general+=" "+h),!f||(1!=a.options.showDropDownIcon||0!=b[a.options.dataFields.selected])&&q&&u(b)||1!=a.options.showDropDownIcon&&"hovered"!=g||a.options.loadItem||(l.general=a.options.rtl?l.general+(" "+a.options.controlStyle.block.marker.expand.rtlDown):
l.general+(" "+a.options.controlStyle.block.marker.expand.down)));h=k.content;h!=a.options.controlStyle.root.content&&(l.content+=" "+h);b==a.options.loadItem&&(h=k.loadIcon.icon,l.loadIcon+=" "+h,h!=a.options.controlStyle.root.loadIcon.icon&&(l.loadIcon+=" "+h));break;default:k=a.getCurrentItemStyle(b),h=a.getCurrentItemStyle(b,g),h!=a.options.controlStyle.item.general.normal&&(l.general+=" "+h),f&&"selected"!=g&&!a.options.loadItem&&(l.general=a.options.rtl?l.general+(" "+a.options.controlStyle.block.marker.expand.left):
l.general+(" "+a.options.controlStyle.block.marker.expand.right)),h=k.content,h!=a.options.controlStyle.item.content&&(l.content+=" "+h),b==a.options.loadItem&&(h=k.loadIcon.icon,l.loadIcon+=" "+h,h!=a.options.controlStyle.item.loadIcon.icon&&(l.loadIcon+=" "+h))}e.style=l;void 0==c&&n.$apply()}}else{e=a.defaultStyle.general.normal;a.options.controlStyle&&(e!=a.options.controlStyle.general.normal&&(e+=" "+a.options.controlStyle.general.normal),0==a.options.enabled&&a.options.controlStyle.general.disabled&&
m.isString(a.options.controlStyle.general.disabled)&&(e+=" "+a.options.controlStyle.general.disabled));d.removeAttr("class");d.addClass(e);for(e=0;e<a.fullList.length;e++)a.fullList[e][a.options.dataFields.selected]=!1;for(e=a.hoverItem;e;)e[a.options.dataFields.selected]=!0,e=a.getParent(e);for(e=0;e<a.fullList.length;e++)a.refresh(a.fullList[e],!1);1==c&&n.$apply()}};var y=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){return"<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>"+
(a[1]+a[4]+a[2]+a[0]+a[3])+"</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(y.tpar));this.tmp=300;this.twp=200*this.tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",d[0].scrollTop+"px"),this.$tw.css("left",d[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",
d[0].scrollTop+"px"),this.$tw.css("left",d[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=e(function(){y.trActive||(y.trCount=0,y.trActive=!0,y.trId=g(function(){y.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(g.cancel(this.trId),this.trId=null);this.trlTime&&(e.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};d.append(this.$tw);this.s1t(this.twp);angular.isDefined(k.options)?a.updateOptions(k.options):(angular.isDefined(k.controlStyle)&&a.updateControlStyle(k.controlStyle),
0==k.enabled&&(a.options.enabled=k.enabled),angular.isDefined(k.itemIcon)&&(a.options.itemIcon=k.itemIcon),1==k.openOnHover&&(a.options.openOnHover=k.openOnHover),angular.isDefined(k.displayMode)&&(a.options.displayMode=k.displayMode),1==k.rtl&&(a.options.rtl=k.rtl),1==k.showDropdownIcon&&(a.options.showDropDownIcon=k.showDropdownIcon),0==k.showIcons&&(a.options.showIcons=k.showIcons));a.updateLayout();k.$on("$destroy",function(a){y.s2t();angular.element(w).unbind("click",I);angular.element(w).unbind("keydown",
f);x();n&&n.$destroy()})}}}]);